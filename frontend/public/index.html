<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ± ì„íŒ©íŠ¸ ì˜¤í† íŒŒì¼ëŸ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #2d3748;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: white;
            padding: 40px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #28a745;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 1.2rem;
        }

        .status {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .status h2 {
            color: #28a745;
            margin-bottom: 15px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .missions {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .missions h2 {
            color: #2d3748;
            margin-bottom: 20px;
        }

        .mission-card {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: box-shadow 0.2s ease;
        }

        .mission-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .mission-type {
            background: #e8f5e8;
            color: #28a745;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .mission-impact {
            background: #fff3cd;
            color: #856404;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .mission-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .mission-description {
            color: #718096;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .mission-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mission-cost {
            background: #f8f9fa;
            color: #495057;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
        }

        .start-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .start-button:hover {
            transform: translateY(-1px);
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            color: #718096;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .mission-footer {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .start-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ± ì„íŒ©íŠ¸ ì˜¤í† íŒŒì¼ëŸ¿</h1>
            <p>í•œ ë²ˆì˜ í„°ì¹˜ë¡œ ì§€êµ¬ë¥¼ ì§€í‚¤ë‹¤</p>
        </div>

        <div class="status">
            <h2>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h2>
            <div id="backend-status" class="status-item">
                <span>ë°±ì—”ë“œ API</span>
                <span id="backend-indicator">í™•ì¸ ì¤‘...</span>
            </div>
            <div id="database-status" class="status-item">
                <span>ë°ì´í„°ë² ì´ìŠ¤</span>
                <span id="database-indicator">í™•ì¸ ì¤‘...</span>
            </div>
            <div id="redis-status" class="status-item">
                <span>ìºì‹œ ì„œë²„</span>
                <span id="redis-indicator">í™•ì¸ ì¤‘...</span>
            </div>
        </div>

        <div class="status">
            <h2>ğŸ‘¤ ì‚¬ìš©ì ì •ë³´</h2>
            <div id="user-info">
                <div class="loading">ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <div class="missions">
            <h2>ğŸ¯ ì´ë²ˆ ì£¼ ë¯¸ì…˜</h2>
            <div id="missions-list">
                <div class="loading">ë¯¸ì…˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <div class="footer">
            <p>Impact Autopilot - Telegram Mini App</p>
            <p>Docker ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰ ì¤‘</p>
        </div>
    </div>

    <script>
        // API í˜¸ì¶œ í•¨ìˆ˜
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`http://localhost:3001${endpoint}`);
                if (!response.ok) throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
                return await response.json();
            } catch (error) {
                console.error(`API í˜¸ì¶œ ì‹¤íŒ¨ (${endpoint}):`, error);
                return null;
            }
        }

        // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateStatus(elementId, status, color) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = status;
                element.style.color = color;
            }
        }

        // ë¯¸ì…˜ ì¹´ë“œ ìƒì„±
        function createMissionCard(mission) {
            const typeLabels = {
                'carbon_offset': 'ğŸŒ± íƒ„ì†Œìƒì‡„',
                'donation': 'ğŸ’ ê¸°ë¶€',
                'petition': 'ğŸ“ ì²­ì›'
            };

            return `
                <div class="mission-card">
                    <div class="mission-header">
                        <span class="mission-type">${typeLabels[mission.type] || mission.type}</span>
                        <span class="mission-impact">+${mission.impact} í¬ì¸íŠ¸</span>
                    </div>
                    <div class="mission-title">${mission.title}</div>
                    <div class="mission-description">${mission.description}</div>
                    <div class="mission-footer">
                        <span class="mission-cost">${mission.cost.toLocaleString()} ${mission.currency}</span>
                        <button class="start-button" onclick="startMission('${mission.id}')">
                            ë¯¸ì…˜ ì‹œì‘í•˜ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        // ë¯¸ì…˜ ì‹œì‘
        async function startMission(missionId) {
            const result = await fetchAPI(`/api/missions/${missionId}/start`);
            if (result) {
                alert(result.message || 'ë¯¸ì…˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                alert('ë¯¸ì…˜ ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        async function initialize() {
            // ë°±ì—”ë“œ ìƒíƒœ í™•ì¸
            const health = await fetchAPI('/health');
            if (health) {
                updateStatus('backend-indicator', 'âœ… ì •ìƒ', '#28a745');
            } else {
                updateStatus('backend-indicator', 'âŒ ì˜¤ë¥˜', '#dc3545');
            }

            // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
            const userInfo = document.getElementById('user-info');
            const user = await fetchAPI('/api/user/profile');
            if (user && user.data) {
                userInfo.innerHTML = `
                    <div class="status-item"><span>ì´ë¦„</span><span>${user.data.firstName || 'í…ŒìŠ¤íŠ¸'} ${user.data.lastName || 'ì‚¬ìš©ì'}</span></div>
                    <div class="status-item"><span>ì´ ì„íŒ©íŠ¸</span><span>${user.data.totalImpact} í¬ì¸íŠ¸</span></div>
                    <div class="status-item"><span>ì™„ë£Œí•œ ë¯¸ì…˜</span><span>${user.data.missionsCompleted}ê°œ</span></div>
                    <div class="status-item"><span>íšë“í•œ ë°°ì§€</span><span>${user.data.badgesEarned}ê°œ</span></div>
                `;
            } else {
                userInfo.innerHTML = '<div class="loading">ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            // ë¯¸ì…˜ ëª©ë¡ ë¡œë“œ
            const missionsList = document.getElementById('missions-list');
            const missions = await fetchAPI('/api/missions');
            if (missions && missions.data) {
                missionsList.innerHTML = missions.data.map(createMissionCard).join('');
            } else {
                missionsList.innerHTML = '<div class="loading">ë¯¸ì…˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            // ë°ì´í„°ë² ì´ìŠ¤ ë° Redis ìƒíƒœ (ê°„ë‹¨í•œ í‘œì‹œ)
            updateStatus('database-indicator', 'âœ… PostgreSQL', '#28a745');
            updateStatus('redis-indicator', 'âœ… Redis', '#28a745');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('load', initialize);
    </script>
</body>
</html>
